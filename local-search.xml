<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>暂缓过去珍惜现在迎接未来</title>
    <link href="/2024/07/26/%E6%9A%82%E7%BC%93%E8%BF%87%E5%8E%BB%E8%BF%8E%E6%8E%A5%E7%8E%B0%E5%9C%A8/"/>
    <url>/2024/07/26/%E6%9A%82%E7%BC%93%E8%BF%87%E5%8E%BB%E8%BF%8E%E6%8E%A5%E7%8E%B0%E5%9C%A8/</url>
    
    <content type="html"><![CDATA[<h4 id="这10年我都做了什么？"><a href="#这10年我都做了什么？" class="headerlink" title="这10年我都做了什么？"></a>这10年我都做了什么？</h4><p>1994年出生，2014年我22岁，踏入互联网行业，那时正是互联网风口，毫无悬念我被吹起来了！</p><p>学习这个专业，一开始是因为我要成为那非常酷的黑客，但进入行业后发现”黑客”这个定位离我非常的遥远，因为我已经隐约知道想成为一名黑客需要具备的技术能力，认知能力的要求是非常非常深高的，我不仅仅要了解计算机原理，编程语言，数据结构，网络架构，操作系统，还有各种各样的工具使用，以及层出不穷的攻击手段（xss，sqlmap，cc，dos，ddos，csrf，暴力破解，病毒，木马，中间人攻击，dns劫持，网络洪水攻击，中间人(MITM)类型的网络攻击，社会工程学攻击，恶意软件，会话劫持，网络钓鱼，内存溢出，勒索软件等），给人一种大山就在眼前，你很难很难逾越，这种感觉让我不得不放弃那好高骛远的想法，从基础做起，从基础学起！ </p><p>这就是我刚入行第一年给我的冲击！</p><p>第二年我在国内安全设备公司做安全交付，学会了网络漏洞扫描，安全报告编写，商务会谈，直接对客户出方案卖安全产品。最后交付到客户环境中去；因为客户类型较多，让我懂得了什么叫 “客户虐你千百遍，我待客户如初恋！”，也许只有经历过的人才会懂～</p><p>第三年我终于熟练掌握了linux和其生态，也结识了很多圈内的大佬，其中有一位名叫ln(网名)的小哥（目前已经见面，非常稳重，且可靠的朋友），他给予了我巨大（重生）的帮助，直接或间接的推进我的成长，真正的掌握核心技术，身价暴涨2倍多，这就是我24岁那个时候的状态，也遇到了那个说“就给你一次机会，没事”的项目经理（唐老板），那时候我差点哭出来，终于～</p><p>2019年锋芒毕露的我，觉得自己非常棒，写了很多文档，买了好多网课，不断学习和成长； 同时我也谈恋爱了 我很喜欢她（到骨子那种）一切都是顺利的，<br>2019年中我换工作分别去了某电信sim卡巨头，华为外包（松山湖溪村，难忘的一次工作，见闻逼格得到提升）； 还去了阿里旗下子公司浩鲸云（做金融板块，当时同事有北大的有清华，而我…）   </p><p>2019年终，去了某基金公司做第一次独立运维开发工作（其实就是ci cd流水线搭建，各种语言的流水线 c  c# java python go vue），我领导是个姐姐，挺会办事的，只可惜我是外包员工，在某个时候或许是有那么一些自卑的，待了了8个月就离开了，<br>2020年去了目前做扫地机器人top5的公司，差不多两年，度过了可怕的疫情期（疫情本身不可怕），也顺利在疫情期间结婚了！ 此时已经2022年终，我也已经28岁！</p><p>28岁，已婚，对未来有着无限幻想，大胆的不顾同事们的劝阻离职，去寻找新的出路，没想到到处都是陷阱，其实出路哪里有那么好找呢？ 对吧 哈哈！</p><p>29岁 某智能水表公司，某游戏公司，某扫地机器人公司（老板人特别好，只可惜没拿到融资），某日本交易所团队度过了我的29岁！</p><p>2023年12月 与吾儿见面，举家迁移到贵州老家农村休息了7个月，老婆也辞去工作，专心为家庭付出所有心血！</p><p>这几个月，我创建了游戏工作室，学习进入电商赛道，这都算是开辟了新的道路哈，而这仅仅只是开始，因为我一直都相信，只要思想不停歇，那么路就一定会越来越多</p><p>2024年 互联风口算是过去了，各种裁员的信息～ 夹杂着铺天盖地的AI与语言模型来临，以及前两年的爆火web2.0短视频风口！ </p><p>新的风口早已出现，只是因为认知问题，还不知道怎么去迎接她，那么我就持小小沧桑之剑，继往静候新的风口把我吹起来！</p><p>这就是我这10年做的经历～</p><h4 id="新的路程，新的思考"><a href="#新的路程，新的思考" class="headerlink" title="新的路程，新的思考"></a>新的路程，新的思考</h4><p>30岁 送给自己最好的礼物就是人格的完善，认知的契合！<br>我学习了AI大语言模型，我学习了视频创作，我坚持做好以往的积累，持续深入下去<br>新的项目也在追赶风口，希望一切顺利，我也祝福和尽己力守护我们能走向成功！</p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>举头三尺有神明，神游天地为星辰。  我就是：  雪落星辰</p><p>感谢自己，走过千山万水，依旧保持向上的心～<br>谢谢你 我的前半生～ 再见，你以后就是回忆了。</p>]]></content>
    
    
    
    <tags>
      
      <tag>历年总结</tag>
      
      <tag>新的历程</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>01-游戏工作室运营框架</title>
    <link href="/2024/07/25/01-%E6%B8%B8%E6%88%8F%E5%B7%A5%E4%BD%9C%E5%AE%A4%E8%BF%90%E8%90%A5%E6%A1%86%E6%9E%B6/"/>
    <url>/2024/07/25/01-%E6%B8%B8%E6%88%8F%E5%B7%A5%E4%BD%9C%E5%AE%A4%E8%BF%90%E8%90%A5%E6%A1%86%E6%9E%B6/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>运营</category>
      
      <category>新赛道</category>
      
    </categories>
    
    
    <tags>
      
      <tag>原创</tag>
      
      <tag>运营</tag>
      
      <tag>新赛道</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>02-AfterEffects基础知识</title>
    <link href="/2024/07/25/02-AfterEffects%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    <url>/2024/07/25/02-AfterEffects%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>AE</category>
      
      <category>视频后期</category>
      
    </categories>
    
    
    <tags>
      
      <tag>原创</tag>
      
      <tag>AE</tag>
      
      <tag>视频后期</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>01-AfterEffects认识和配置</title>
    <link href="/2024/07/25/01-AfterEffects%E8%AE%A4%E8%AF%86%E5%92%8C%E9%85%8D%E7%BD%AE/"/>
    <url>/2024/07/25/01-AfterEffects%E8%AE%A4%E8%AF%86%E5%92%8C%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>AE</category>
      
      <category>视频后期</category>
      
    </categories>
    
    
    <tags>
      
      <tag>原创</tag>
      
      <tag>AE</tag>
      
      <tag>视频后期</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>08-AI基于大语言模型的应用开发</title>
    <link href="/2024/07/25/08-AI%E5%9F%BA%E4%BA%8E%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/"/>
    <url>/2024/07/25/08-AI%E5%9F%BA%E4%BA%8E%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>人工智能</category>
      
      <category>大语言模型</category>
      
    </categories>
    
    
    <tags>
      
      <tag>原创</tag>
      
      <tag>人工智能</tag>
      
      <tag>大语言模型</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>07-AI开源大语言模型微调与开发</title>
    <link href="/2024/07/25/07-AI%E5%BC%80%E6%BA%90%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83%E4%B8%8E%E5%BC%80%E5%8F%91/"/>
    <url>/2024/07/25/07-AI%E5%BC%80%E6%BA%90%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83%E4%B8%8E%E5%BC%80%E5%8F%91/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>人工智能</category>
      
      <category>大语言模型</category>
      
    </categories>
    
    
    <tags>
      
      <tag>原创</tag>
      
      <tag>人工智能</tag>
      
      <tag>大语言模型</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>06-AI开源大语言模型使用</title>
    <link href="/2024/07/25/06-AI%E5%BC%80%E6%BA%90%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%BD%BF%E7%94%A8/"/>
    <url>/2024/07/25/06-AI%E5%BC%80%E6%BA%90%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>人工智能</category>
      
      <category>大语言模型</category>
      
    </categories>
    
    
    <tags>
      
      <tag>原创</tag>
      
      <tag>人工智能</tag>
      
      <tag>大语言模型</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>05-AI大语言模型融合Linux系统</title>
    <link href="/2024/07/25/05-AI%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E8%9E%8D%E5%90%88Linux%E7%B3%BB%E7%BB%9F/"/>
    <url>/2024/07/25/05-AI%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E8%9E%8D%E5%90%88Linux%E7%B3%BB%E7%BB%9F/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>人工智能</category>
      
      <category>大语言模型</category>
      
    </categories>
    
    
    <tags>
      
      <tag>原创</tag>
      
      <tag>人工智能</tag>
      
      <tag>大语言模型</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>04-AI大语言模型api使用</title>
    <link href="/2024/07/25/04-AI%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8Bapi%E4%BD%BF%E7%94%A8/"/>
    <url>/2024/07/25/04-AI%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8Bapi%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>人工智能</category>
      
      <category>大语言模型</category>
      
    </categories>
    
    
    <tags>
      
      <tag>原创</tag>
      
      <tag>人工智能</tag>
      
      <tag>大语言模型</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>03-AI大语言模型实践</title>
    <link href="/2024/07/25/03-AI%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E5%AE%9E%E8%B7%B5/"/>
    <url>/2024/07/25/03-AI%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E5%AE%9E%E8%B7%B5/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>人工智能</category>
      
      <category>大语言模型</category>
      
    </categories>
    
    
    <tags>
      
      <tag>原创</tag>
      
      <tag>人工智能</tag>
      
      <tag>大语言模型</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>02-AI分类与当前矩阵</title>
    <link href="/2024/07/25/02-AI%E5%88%86%E7%B1%BB%E4%B8%8E%E5%BD%93%E5%89%8D%E7%9F%A9%E9%98%B5/"/>
    <url>/2024/07/25/02-AI%E5%88%86%E7%B1%BB%E4%B8%8E%E5%BD%93%E5%89%8D%E7%9F%A9%E9%98%B5/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>人工智能</category>
      
      <category>大语言模型</category>
      
    </categories>
    
    
    <tags>
      
      <tag>原创</tag>
      
      <tag>人工智能</tag>
      
      <tag>大语言模型</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>01-AI人工智能基础认知</title>
    <link href="/2024/07/25/01-AI%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E5%9F%BA%E7%A1%80%E8%AE%A4%E7%9F%A5/"/>
    <url>/2024/07/25/01-AI%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E5%9F%BA%E7%A1%80%E8%AE%A4%E7%9F%A5/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>人工智能</category>
      
      <category>大语言模型</category>
      
    </categories>
    
    
    <tags>
      
      <tag>原创</tag>
      
      <tag>人工智能</tag>
      
      <tag>大语言模型</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>05-alertmanager部署对接</title>
    <link href="/2024/07/25/05-alertmanager%E9%83%A8%E7%BD%B2%E5%AF%B9%E6%8E%A5/"/>
    <url>/2024/07/25/05-alertmanager%E9%83%A8%E7%BD%B2%E5%AF%B9%E6%8E%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="1-alertmanager部署"><a href="#1-alertmanager部署" class="headerlink" title="1.alertmanager部署"></a>1.alertmanager部署</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python">[root@prometheus-server ~]<span class="hljs-comment"># wget https://github.com/prometheus/alertmanager/releases/download/v0.22.2/alertmanager-0.22.2.linux-amd64.tar.gz</span><br>[root@prometheus-server ~]<span class="hljs-comment"># tar -xf alertmanager-0.22.2.linux-amd64.tar.gz -C /usr/local/</span><br>[root@prometheus-server ~]<span class="hljs-comment"># cd /usr/local/ &amp;&amp; ln -sv alertmanager-0.22.2.linux-amd64 alertmanager</span><br>[root@prometheus-server ~]<span class="hljs-comment"># cd /usr/local/alertmanager &amp;&amp; mkdir config bin data logs</span><br><br>将配置文件放到config中<br>将日志文件指定到logs中<br>将二进制程序放到<span class="hljs-built_in">bin</span>中<br>[root@prometheus-server alertmanager]<span class="hljs-comment"># mv alertmanager amtool bin/</span><br>[root@prometheus-server alertmanager]<span class="hljs-comment"># mv alertmanager.yml conf/</span><br>[root@prometheus-server alertmanager]<span class="hljs-comment"># mv alertmanager amtool bin/</span><br>[root@prometheus-server alertmanager]<span class="hljs-comment"># vim /usr/lib/systemd/system/alertmanager.service</span><br>[Unit]<br>Description=alertmanager<br>Documentation=https://prometheus.io/<br>After=network.target<br><br>[Service]<br>ExecStart=/usr/local/alertmanager/<span class="hljs-built_in">bin</span>/alertmanager --config.file=/usr/local/alertmanager/config/alertmanager.yml --log.level=info --log.<span class="hljs-built_in">format</span>=json --storage.path=<span class="hljs-string">&quot;/urs/local/alertmanager/data/&quot;</span><br>ExecReload=/<span class="hljs-built_in">bin</span>/kill -HUP $MAINPID<br>ExecStop=/<span class="hljs-built_in">bin</span>/kill -KILL $MAINPID<br><span class="hljs-type">Type</span>=simple<br>Restart=always<br>TimeoutStopSec=20s<br><br>[Install]<br>WantedBy=multi-user.target:<br><br></code></pre></td></tr></table></figure><h1 id="2-告警配置-alertmanager-webhook"><a href="#2-告警配置-alertmanager-webhook" class="headerlink" title="2.告警配置 alertmanager-webhook"></a>2.告警配置 alertmanager-webhook</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python">root@VM-<span class="hljs-number">24</span>-<span class="hljs-number">6</span>-ubuntu:usr/local/alertmanager-webhook<span class="hljs-comment"># cat alertmanager-webhook.yaml </span><br><span class="hljs-comment"># 企业微信机器人key</span><br><span class="hljs-comment"># 使用企业微信时必须配置，不使用则留空</span><br>qywechatKey:<br><br><span class="hljs-comment"># 飞书机器人key</span><br><span class="hljs-comment"># 使用飞书时必须配置，不使用则留空</span><br>feishuKey: <span class="hljs-string">&quot;e791jbei-982e-4f6b-b5s09-e739e2fd3a15s&quot;</span><br><br><span class="hljs-comment"># 钉钉机器人key</span><br><span class="hljs-comment"># 使用钉钉时必须配置，不使用则留</span><br>dingdingKey:<br><br><span class="hljs-comment"># Redis配置</span><br>redisServer: <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>  <span class="hljs-comment"># 必须配置</span><br>redisPort: <span class="hljs-number">6379</span> <span class="hljs-comment"># 可选项，为空默认为6379</span><br>redisPassword: <span class="hljs-string">&quot;12345678&quot;</span> <span class="hljs-comment"># redis未设置密码则留空，如果设置了密码登陆则必须配置</span><br><br><span class="hljs-comment"># 日志配置</span><br>logFileDir:   <span class="hljs-comment"># 可选项，为空则为程序运行目录</span><br>logFilePath: alertmanager-webhook.log <span class="hljs-comment"># 必须配置</span><br><br><span class="hljs-comment"># 服务监听配置</span><br>port: <span class="hljs-number">9095</span> <span class="hljs-comment"># 可选项，为空则默认为9095</span><br>host: <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span> <span class="hljs-comment"># 可选项，为空默认监听 127.0.0.1</span><br></code></pre></td></tr></table></figure><h2 id="2-1-部署alertmanager-webhook使用的redis服务"><a href="#2-1-部署alertmanager-webhook使用的redis服务" class="headerlink" title="2.1 部署alertmanager-webhook使用的redis服务"></a>2.1 部署alertmanager-webhook使用的redis服务</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">$ docker run -d <span class="hljs-attr">--name</span> redis_alertmanager -<span class="hljs-selector-tag">p</span> <span class="hljs-number">56379</span>:<span class="hljs-number">6379</span> redis:<span class="hljs-number">4</span> redis-server <span class="hljs-attr">--requirepass</span> <span class="hljs-number">12345678</span><br></code></pre></td></tr></table></figure><h2 id="2-2-配置服务管理文件"><a href="#2-2-配置服务管理文件" class="headerlink" title="2.2 配置服务管理文件"></a>2.2 配置服务管理文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python">$ vim /etc/systemd/system/alertmanager-webhook.service<br>[Unit]<br>Description=Alertmanager Webhook Service<br>After=network.target<br><br>[Service]<br><span class="hljs-type">Type</span>=simple<br>ExecStart=/usr/local/alertmanager-webhook/alertmanager-webhook -c /usr/local/alertmanager-webhook/alertmanager-webhook.yaml<br>Restart=on-failure<br>User=root<br>Group=root<br>WorkingDirectory=/usr/local/alertmanager-webhook<br><br>[Install]<br>WantedBy=multi-user.target<br><br><span class="hljs-comment">#  启动服务</span><br>$ systemctl enable alertmanager-webhook<br>$ systemctl start alertmanager-webhook<br>$ systemctl status alertmanager-webhook<br><br></code></pre></td></tr></table></figure><h1 id="3-告警测试"><a href="#3-告警测试" class="headerlink" title="3.告警测试"></a>3.告警测试</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># CPU测试</span><br>$ nohup cat /dev/zero&gt;/dev/null <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> &amp;<br><br>过滤dd 指令获取<span class="hljs-built_in">id</span>号<br>$ <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `seq <span class="hljs-number">1</span> $(cat /proc/cpuinfo |grep <span class="hljs-string">&quot;physical id&quot;</span> |wc -l)`; do dd <span class="hljs-keyword">if</span>=/dev/zero of=/dev/null &amp; done <br>$ fg<br>$ ctrl + C 结束 <br><span class="hljs-comment"># 强制杀掉</span><br>ps aux |grep -v grep |grep <span class="hljs-string">&quot;dd if&quot;</span>| awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>| xargs -i kill -<span class="hljs-number">9</span> &#123;&#125;<br><br><br><span class="hljs-comment"># 磁盘测试</span><br>$ dd <span class="hljs-keyword">if</span>=/dev/zero of=test1.txt bs=1M count=<span class="hljs-number">40960</span>  40GiB<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>prometheus</category>
      
    </categories>
    
    
    <tags>
      
      <tag>原创</tag>
      
      <tag>prometheus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>03-promettheus-服务配置</title>
    <link href="/2024/07/25/03-promettheus-%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE/"/>
    <url>/2024/07/25/03-promettheus-%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<h2 id="1-主配置文件"><a href="#1-主配置文件" class="headerlink" title="1.主配置文件"></a>1.主配置文件</h2><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">global</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">scrape_interval</span><span class="hljs-punctuation">:</span> <span class="hljs-string">15s</span><br>  <span class="hljs-attribute">evaluation_interval</span><span class="hljs-punctuation">:</span> <span class="hljs-string">15s</span><br>  <span class="hljs-attribute">query_log_file</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;query.log&#x27;</span><br><br><span class="hljs-attribute">alerting</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">alertmanagers</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">static_configs:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">targets: [&#x27;localhost:9093&#x27;]</span><br><br><span class="hljs-attribute">rule_files</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">/usr/local/prometheus/rules/*rules.yml</span><br><br><span class="hljs-attribute">scrape_configs</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-comment"># Prometheus 自身监控配置</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">job_name: &#x27;prometheus&#x27;</span><br>    <span class="hljs-attribute">static_configs</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">targets: [&#x27;localhost:9090&#x27;]</span><br><br>  <span class="hljs-comment"># 监控 Node Exporter 的配置</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">job_name: &#x27;node_exporter&#x27;</span><br>    <span class="hljs-attribute">file_sd_configs</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">files:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">/usr/local/prometheus/targets/node_targets.yml</span><br>        <span class="hljs-attribute">refresh_interval</span><span class="hljs-punctuation">:</span> <span class="hljs-string">3s</span><br><br>  <span class="hljs-comment"># 监控 Docker 容器的配置</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">job_name: &#x27;docker&#x27;</span><br>    <span class="hljs-attribute">file_sd_configs</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">files:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">/usr/local/prometheus/targets/docker_targets.yml</span><br>        <span class="hljs-attribute">refresh_interval</span><span class="hljs-punctuation">:</span> <span class="hljs-string">3s</span><br>    <span class="hljs-attribute">relabel_configs</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">source_labels: [__address__]</span><br>        <span class="hljs-attribute">regex</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;(.*):\d+&#x27;</span><br>        <span class="hljs-attribute">target_label</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;__address__&#x27;</span><br>        <span class="hljs-attribute">replacement</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;$&#123;1&#125;:9323&#x27;</span><br><br>  <span class="hljs-comment"># 监控mysql  </span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">job_name: &#x27;mysql_exporter&#x27;</span><br>    <span class="hljs-attribute">static_configs</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">labels:</span><br>          <span class="hljs-attribute">instance</span><span class="hljs-punctuation">:</span> <span class="hljs-string">prod-2024:3306</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">targets:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">x.x.x.x:9104</span><br></code></pre></td></tr></table></figure><h1 id="2-主目录下路径"><a href="#2-主目录下路径" class="headerlink" title="2.主目录下路径"></a>2.主目录下路径</h1><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/usr/local/prometheus</span><span class="hljs-comment"># ls targets/</span><br>docker_targets.yml  node_targets.yml<br>root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/usr/local/prometheus</span><span class="hljs-comment"># ls rules/</span><br>container.rules.yml  container.rules.ymlbal  hosts.rules.yml  mysql.rules.yml<br><span class="hljs-comment"># 这里规则信息可以去站点获取： https://samber.github.io/awesome-prometheus-alerts</span><br><br></code></pre></td></tr></table></figure><h1 id="3-查看目标配置情况-其他的都类似"><a href="#3-查看目标配置情况-其他的都类似" class="headerlink" title="3.查看目标配置情况 其他的都类似"></a>3.查看目标配置情况 其他的都类似</h1><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">$ cat targets/docker_targets.yml </span><br><span class="hljs-attribute">- targets</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;192.168.9.11:9100&#x27;</span><br>  <span class="hljs-attribute">labels</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span> <span class="hljs-string">cicd</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;192.168.6.10:9100&#x27;</span><br>  <span class="hljs-attribute">labels</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span> <span class="hljs-string">harbor</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;192.168.9.250:9100&#x27;</span><br>  <span class="hljs-attribute">labels</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span> <span class="hljs-string">gitlab</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;192.168.9.8:9100&#x27;</span><br>  <span class="hljs-attribute">labels</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span> <span class="hljs-string">jenkins</span><br></code></pre></td></tr></table></figure><h1 id="4-告警规则文件-这里仅作为示例-具体根据需求增加"><a href="#4-告警规则文件-这里仅作为示例-具体根据需求增加" class="headerlink" title="4.告警规则文件 这里仅作为示例 具体根据需求增加"></a>4.告警规则文件 这里仅作为示例 具体根据需求增加</h1><ul><li>获取网站：  <a href="https://samber.github.io/awesome-prometheus-alerts">https://samber.github.io/awesome-prometheus-alerts</a></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">root@ubuntu:/usr/local/prometheus#</span> <span class="hljs-string">cat</span> <span class="hljs-string">rules/hosts.rules.yml</span> <br><span class="hljs-attr">groups:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Hosts</span><br>  <span class="hljs-attr">rules:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">HighCPUUsage</span><br>    <span class="hljs-attr">expr:</span> <span class="hljs-number">100</span> <span class="hljs-bullet">-</span> <span class="hljs-string">(avg</span> <span class="hljs-string">by</span> <span class="hljs-string">(instance)</span> <span class="hljs-string">(rate(node_cpu_seconds_total&#123;mode=&quot;idle&quot;&#125;[5m]))</span> <span class="hljs-string">*</span> <span class="hljs-number">100</span><span class="hljs-string">)</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">80</span><br>    <span class="hljs-attr">for:</span> <span class="hljs-string">15s</span><br>    <span class="hljs-attr">labels:</span><br>      <span class="hljs-attr">severity:</span> <span class="hljs-string">critical</span><br>    <span class="hljs-attr">annotations:</span><br>      <span class="hljs-attr">summary:</span> <span class="hljs-string">&quot;Instance <span class="hljs-template-variable">&#123;&#123; $labels.instance &#125;&#125;</span> CPU usage is high&quot;</span><br>      <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;CPU usage is above 80% (current value: <span class="hljs-template-variable">&#123;&#123; $value &#125;&#125;</span>)&quot;</span><br> <br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">HighMemoryUsage</span><br>    <span class="hljs-attr">expr:</span> <span class="hljs-string">node_memory_MemAvailable_bytes</span> <span class="hljs-string">/</span> <span class="hljs-string">node_memory_MemTotal_bytes</span> <span class="hljs-string">*</span> <span class="hljs-number">100</span> <span class="hljs-string">&lt;</span> <span class="hljs-number">10</span><br>    <span class="hljs-attr">for:</span> <span class="hljs-string">15s</span><br>    <span class="hljs-attr">labels:</span><br>      <span class="hljs-attr">severity:</span> <span class="hljs-string">warning</span><br>    <span class="hljs-attr">annotations:</span><br>      <span class="hljs-attr">summary:</span> <span class="hljs-string">&quot;Instance <span class="hljs-template-variable">&#123;&#123; $labels.instance &#125;&#125;</span> memory usage is high&quot;</span><br>      <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Memory usage is below 10% (current value: <span class="hljs-template-variable">&#123;&#123; $value &#125;&#125;</span>)&quot;</span><br>  <br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">HostOutOfMemory</span><br>    <span class="hljs-attr">expr:</span> <span class="hljs-string">(node_memory_MemAvailable_bytes</span> <span class="hljs-string">/</span> <span class="hljs-string">node_memory_MemTotal_bytes</span> <span class="hljs-string">*</span> <span class="hljs-number">100</span> <span class="hljs-string">&lt;</span> <span class="hljs-number">10</span><span class="hljs-string">)</span> <span class="hljs-string">*</span> <span class="hljs-string">on(instance)</span> <span class="hljs-string">group_left</span> <span class="hljs-string">(nodename)</span> <span class="hljs-string">node_uname_info&#123;nodename=~&quot;.+&quot;&#125;</span><br>    <span class="hljs-attr">for:</span> <span class="hljs-string">1m</span><br>    <span class="hljs-attr">labels:</span><br>      <span class="hljs-attr">severity:</span> <span class="hljs-string">warning</span><br>    <span class="hljs-attr">annotations:</span><br>      <span class="hljs-attr">summary:</span> <span class="hljs-string">Host</span> <span class="hljs-string">out</span> <span class="hljs-string">of</span> <span class="hljs-string">memory</span> <span class="hljs-string">(instance</span> &#123;&#123; <span class="hljs-string">$labels.instance</span> &#125;&#125;<span class="hljs-string">)</span><br>      <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Node memory is filling up (&lt; 10% left)\n  VALUE = <span class="hljs-template-variable">&#123;&#123; $value &#125;&#125;</span>\n  LABELS = <span class="hljs-template-variable">&#123;&#123; $labels &#125;&#125;</span>&quot;</span><br><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">HostMemoryUnderMemoryPressure</span><br>    <span class="hljs-attr">expr:</span> <span class="hljs-string">(rate(node_vmstat_pgmajfault[1m])</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">1000</span><span class="hljs-string">)</span> <span class="hljs-string">*</span> <span class="hljs-string">on(instance)</span> <span class="hljs-string">group_left</span> <span class="hljs-string">(nodename)</span> <span class="hljs-string">node_uname_info&#123;nodename=~&quot;.+&quot;&#125;</span><br>    <span class="hljs-attr">for:</span> <span class="hljs-string">1m</span><br>    <span class="hljs-attr">labels:</span><br>      <span class="hljs-attr">severity:</span> <span class="hljs-string">warning</span><br>    <span class="hljs-attr">annotations:</span><br>      <span class="hljs-attr">summary:</span> <span class="hljs-string">Host</span> <span class="hljs-string">memory</span> <span class="hljs-string">under</span> <span class="hljs-string">memory</span> <span class="hljs-string">pressure</span> <span class="hljs-string">(instance</span> &#123;&#123; <span class="hljs-string">$labels.instance</span> &#125;&#125;<span class="hljs-string">)</span><br>      <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;The node is under heavy memory pressure. High rate of major page faults\n  VALUE = <span class="hljs-template-variable">&#123;&#123; $value &#125;&#125;</span>\n  LABELS = <span class="hljs-template-variable">&#123;&#123; $labels &#125;&#125;</span>&quot;</span><br><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">HostOutOfDiskSpace</span><br>    <span class="hljs-attr">expr:</span> <span class="hljs-string">((node_filesystem_avail_bytes</span> <span class="hljs-string">*</span> <span class="hljs-number">100</span><span class="hljs-string">)</span> <span class="hljs-string">/</span> <span class="hljs-string">node_filesystem_size_bytes</span> <span class="hljs-string">&lt;</span> <span class="hljs-number">10</span> <span class="hljs-string">and</span> <span class="hljs-string">ON</span> <span class="hljs-string">(instance,</span> <span class="hljs-string">device,</span> <span class="hljs-string">mountpoint)</span> <span class="hljs-string">node_filesystem_readonly</span> <span class="hljs-string">==</span> <span class="hljs-number">0</span><span class="hljs-string">)</span> <span class="hljs-string">*</span> <span class="hljs-string">on(instance)</span> <span class="hljs-string">group_left</span> <span class="hljs-string">(nodename)</span> <span class="hljs-string">node_uname_info&#123;nodename=~&quot;.+&quot;&#125;</span><br>    <span class="hljs-attr">for:</span> <span class="hljs-string">1m</span><br>    <span class="hljs-attr">labels:</span><br>      <span class="hljs-attr">severity:</span> <span class="hljs-string">warning</span><br>    <span class="hljs-attr">annotations:</span><br>      <span class="hljs-attr">summary:</span> <span class="hljs-string">Host</span> <span class="hljs-string">out</span> <span class="hljs-string">of</span> <span class="hljs-string">disk</span> <span class="hljs-string">space</span> <span class="hljs-string">(instance</span> &#123;&#123; <span class="hljs-string">$labels.instance</span> &#125;&#125;<span class="hljs-string">)</span><br>      <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Disk is almost full (&lt; 10% left)\n  VALUE = <span class="hljs-template-variable">&#123;&#123; $value &#125;&#125;</span>\n  LABELS = <span class="hljs-template-variable">&#123;&#123; $labels &#125;&#125;</span>&quot;</span><br><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">HostHighCpuLoad</span><br>    <span class="hljs-attr">expr:</span> <span class="hljs-string">(sum</span> <span class="hljs-string">by</span> <span class="hljs-string">(instance)</span> <span class="hljs-string">(avg</span> <span class="hljs-string">by</span> <span class="hljs-string">(mode,</span> <span class="hljs-string">instance)</span> <span class="hljs-string">(rate(node_cpu_seconds_total&#123;mode!=&quot;idle&quot;&#125;[2m])))</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">0.8</span><span class="hljs-string">)</span> <span class="hljs-string">*</span> <span class="hljs-string">on(instance)</span> <span class="hljs-string">group_left</span> <span class="hljs-string">(nodename)</span> <span class="hljs-string">node_uname_info&#123;nodename=~&quot;.+&quot;&#125;</span><br>    <span class="hljs-attr">for:</span> <span class="hljs-string">5m</span><br>    <span class="hljs-attr">labels:</span><br>      <span class="hljs-attr">severity:</span> <span class="hljs-string">warning</span><br>    <span class="hljs-attr">annotations:</span><br>      <span class="hljs-attr">summary:</span> <span class="hljs-string">Host</span> <span class="hljs-string">high</span> <span class="hljs-string">CPU</span> <span class="hljs-string">load</span> <span class="hljs-string">(instance</span> &#123;&#123; <span class="hljs-string">$labels.instance</span> &#125;&#125;<span class="hljs-string">)</span><br>      <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;CPU load is &gt; 80%\n  VALUE = <span class="hljs-template-variable">&#123;&#123; $value &#125;&#125;</span>\n  LABELS = <span class="hljs-template-variable">&#123;&#123; $labels &#125;&#125;</span>&quot;</span><br> <br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">HostCpuHighIowait</span><br>    <span class="hljs-attr">expr:</span> <span class="hljs-string">(avg</span> <span class="hljs-string">by</span> <span class="hljs-string">(instance)</span> <span class="hljs-string">(rate(node_cpu_seconds_total&#123;mode=&quot;iowait&quot;&#125;[5m]))</span> <span class="hljs-string">*</span> <span class="hljs-number">100</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">10</span><span class="hljs-string">)</span> <span class="hljs-string">*</span> <span class="hljs-string">on(instance)</span> <span class="hljs-string">group_left</span> <span class="hljs-string">(nodename)</span> <span class="hljs-string">node_uname_info&#123;nodename=~&quot;.+&quot;&#125;</span><br>    <span class="hljs-attr">for:</span> <span class="hljs-string">1m</span><br>    <span class="hljs-attr">labels:</span><br>      <span class="hljs-attr">severity:</span> <span class="hljs-string">warning</span><br>    <span class="hljs-attr">annotations:</span><br>      <span class="hljs-attr">summary:</span> <span class="hljs-string">Host</span> <span class="hljs-string">CPU</span> <span class="hljs-string">high</span> <span class="hljs-string">iowait</span> <span class="hljs-string">(instance</span> &#123;&#123; <span class="hljs-string">$labels.instance</span> &#125;&#125;<span class="hljs-string">)</span><br>      <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;CPU iowait &gt; 10%. A high iowait means that you are disk or network bound.\n  VALUE = <span class="hljs-template-variable">&#123;&#123; $value &#125;&#125;</span>\n  LABELS = <span class="hljs-template-variable">&#123;&#123; $labels &#125;&#125;</span>&quot;</span><br>  <br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">HostUnusualDiskIo</span><br>    <span class="hljs-attr">expr:</span> <span class="hljs-string">(rate(node_disk_io_time_seconds_total[1m])</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">0.5</span><span class="hljs-string">)</span> <span class="hljs-string">*</span> <span class="hljs-string">on(instance)</span> <span class="hljs-string">group_left</span> <span class="hljs-string">(nodename)</span> <span class="hljs-string">node_uname_info&#123;nodename=~&quot;.+&quot;&#125;</span><br>    <span class="hljs-attr">for:</span> <span class="hljs-string">1m</span><br>    <span class="hljs-attr">labels:</span><br>      <span class="hljs-attr">severity:</span> <span class="hljs-string">warning</span><br>    <span class="hljs-attr">annotations:</span><br>      <span class="hljs-attr">summary:</span> <span class="hljs-string">Host</span> <span class="hljs-string">unusual</span> <span class="hljs-string">disk</span> <span class="hljs-string">IO</span> <span class="hljs-string">(instance</span> &#123;&#123; <span class="hljs-string">$labels.instance</span> &#125;&#125;<span class="hljs-string">)</span><br>      <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Time spent in IO is too high on <span class="hljs-template-variable">&#123;&#123; $labels.instance &#125;&#125;</span>. Check storage for issues.\n  VALUE = <span class="hljs-template-variable">&#123;&#123; $value &#125;&#125;</span>\n  LABELS = <span class="hljs-template-variable">&#123;&#123; $labels &#125;&#125;</span>&quot;</span><br><br><br><br></code></pre></td></tr></table></figure><h1 id="5-以上便是配置思路和示例"><a href="#5-以上便是配置思路和示例" class="headerlink" title="5.以上便是配置思路和示例"></a>5.以上便是配置思路和示例</h1><ul><li>网站：  <a href="https://samber.github.io/awesome-prometheus-alerts">https://samber.github.io/awesome-prometheus-alerts</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>prometheus</category>
      
    </categories>
    
    
    <tags>
      
      <tag>原创</tag>
      
      <tag>prometheus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>01-prometheus监控基础</title>
    <link href="/2024/07/25/01-prometheus%E7%9B%91%E6%8E%A7%E5%9F%BA%E7%A1%80/"/>
    <url>/2024/07/25/01-prometheus%E7%9B%91%E6%8E%A7%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h1 id="一、Prometheus基础概念"><a href="#一、Prometheus基础概念" class="headerlink" title="一、Prometheus基础概念"></a>一、Prometheus基础概念</h1><p>Prometheus受启发于Google的Brogmon监控系统（相似的Kubernetes是从Google的Brog系统演变而来），从2012年开始由前Google工程师在Soundcloud以开源软件的形式进行研发，并且于2015年早期对外发布早期版本。2016年5月继Kubernetes之后成为第二个正式加入CNCF基金会的项目，同年6月正式发布1.0版本。2017年底发布了基于全新存储层的2.0版本，能更好地与容器平台、云平台配合。</p><p><img src="https://cdn.nlark.com/yuque/0/2021/png/278129/1627716530483-2c211def-5bca-4faf-87e8-9307a8bf8dac.png#clientId=ub9576979-9d34-4&from=paste&id=u45cdc46f&originHeight=269&originWidth=869&originalType=url&ratio=1&size=57768&status=done&style=none&taskId=u8968f5d9-20a2-44c5-b0aa-156b70c2ec4" alt="image.png"></p><h1 id="1-1、Prometheus的优势"><a href="#1-1、Prometheus的优势" class="headerlink" title="1.1、Prometheus的优势"></a>1.1、Prometheus的优势</h1><p>Prometheus是一个开源的完整监控解决方案，其对传统监控系统的测试和告警模型进行了彻底的颠覆，形成了基于中央化的规则计算、统一分析和告警的新模型。 相比于传统监控系统Prometheus具有以下优点：</p><h2 id="1-1-2、易于管理"><a href="#1-1-2、易于管理" class="headerlink" title="1.1.2、易于管理"></a>1.1.2、易于管理</h2><p>Prometheus核心部分只有一个单独的二进制文件，不存在任何的第三方依赖(数据库，缓存等等)。唯一需要的就是本地磁盘，因此不会有潜在级联故障的风险。<br>Prometheus基于Pull模型的架构方式，可以在任何地方（本地电脑，开发环境，测试环境）搭建我们的监控系统。对于一些复杂的情况，还可以使用Prometheus服务发现(Service Discovery)的能力动态管理监控目标。</p><h2 id="1-1-3、监控服务的内部运行状态"><a href="#1-1-3、监控服务的内部运行状态" class="headerlink" title="1.1.3、监控服务的内部运行状态"></a>1.1.3、监控服务的内部运行状态</h2><p>Pometheus鼓励用户监控服务的内部状态，基于Prometheus丰富的Client库，用户可以轻松的在应用程序中添加对Prometheus的支持，从而让用户可以获取服务和应用内部真正的运行状态。</p><h2 id="1-1-4、强大的数据模型"><a href="#1-1-4、强大的数据模型" class="headerlink" title="1.1.4、强大的数据模型"></a>1.1.4、强大的数据模型</h2><p>所有采集的监控数据均以指标(metric)的形式保存在内置的时间序列数据库当中(TSDB)。所有的样本除了基本的指标名称以外，还包含一组用于描述该样本特征的标签。</p><h2 id="1-1-5、强大的查询语言PromQL"><a href="#1-1-5、强大的查询语言PromQL" class="headerlink" title="1.1.5、强大的查询语言PromQL"></a>1.1.5、强大的查询语言PromQL</h2><p>Prometheus内置了一个强大的数据查询语言PromQL。 通过PromQL可以实现对监控数据的查询、聚合。同时PromQL也被应用于数据可视化(如Grafana)以及告警当中。<br>通过PromQL可以轻松回答类似于以下问题：</p><ul><li>在过去一段时间中95%应用延迟时间的分布范围？</li><li>预测在4小时后，磁盘空间占用大致会是什么情况？</li><li>CPU占用率前5位的服务有哪些？(过滤)</li></ul><h2 id="1-1-6、高效"><a href="#1-1-6、高效" class="headerlink" title="1.1.6、高效"></a>1.1.6、高效</h2><p>对于监控系统而言，大量的监控任务必然导致有大量的数据产生。而Prometheus可以高效地处理这些数据，对于单一Prometheus Server实例而言它可以处理：</p><ul><li>数以百万的监控指标</li><li>每秒处理数十万的数据点。</li></ul><h2 id="1-1-7、可扩展"><a href="#1-1-7、可扩展" class="headerlink" title="1.1.7、可扩展"></a>1.1.7、可扩展</h2><p>Prometheus是如此简单，因此你可以在每个数据中心、每个团队运行独立的Prometheus Sevrer。Prometheus对于联邦集群的支持，可以让多个Prometheus实例产生一个逻辑集群，当单实例Prometheus Server处理的任务量过大时，通过使用功能分区(sharding)+联邦集群(federation)可以对其进行扩展。</p><h2 id="1-1-8、易于集成"><a href="#1-1-8、易于集成" class="headerlink" title="1.1.8、易于集成"></a>1.1.8、易于集成</h2><p>使用Prometheus可以快速搭建监控服务，并且可以非常方便地在应用程序中进行集成。目前支持： Java， JMX， Python， Go，Ruby， .Net， Node.js等等语言的客户端SDK，基于这些SDK可以快速让应用程序纳入到Prometheus的监控当中，或者开发自己的监控数据收集程序。同时这些客户端收集的监控数据，不仅仅支持Prometheus，还能支持Graphite这些其他的监控工具。<br>同时Prometheus还支持与其他的监控系统进行集成：Graphite， Statsd， Collected， Scollector， muini， Nagios等。<br>Prometheus社区还提供了大量第三方实现的监控数据采集支持：JMX， CloudWatch， EC2， MySQL， PostgresSQL， Haskell， Bash， SNMP， Consul， Haproxy， Mesos， Bind， CouchDB， Django， Memcached， RabbitMQ， Redis， RethinkDB， Rsyslog等等。</p><h2 id="1-1-9、可视化"><a href="#1-1-9、可视化" class="headerlink" title="1.1.9、可视化"></a>1.1.9、可视化</h2><p>Prometheus Server中自带了一个Prometheus UI，通过这个UI可以方便地直接对数据进行查询，并且支持直接以图形化的形式展示数据。同时Prometheus还提供了一个独立的基于Ruby On Rails的Dashboard解决方案Promdash。最新的Grafana可视化工具也已经提供了完整的Prometheus支持，基于Grafana可以创建更加精美的监控图标。基于Prometheus提供的API还可以实现自己的监控可视化UI。</p><h2 id="1-1-10、开放性"><a href="#1-1-10、开放性" class="headerlink" title="1.1.10、开放性"></a>1.1.10、开放性</h2><p>通常来说当我们需要监控一个应用程序时，一般需要该应用程序提供对相应监控系统协议的支持。因此应用程序会与所选择的监控系统进行绑定。为了减少这种绑定所带来的限制。对于决策者而言要么你就直接在应用中集成该监控系统的支持，要么就在外部创建单独的服务来适配不同的监控系统。<br>而对于Prometheus来说，使用Prometheus的client library的输出格式不止支持Prometheus的格式化数据，也可以输出支持其它监控系统的格式化数据，比如Graphite。<br>因此你甚至可以在不使用Prometheus的情况下，采用Prometheus的client library来让你的应用程序支持监控数据采集。<br>接下来，在本书当中，将带领读者感受Prometheus是如何对监控系统的重新定义。</p><h2 id="1-1-11核心知识"><a href="#1-1-11核心知识" class="headerlink" title="1.1.11核心知识"></a>1.1.11核心知识</h2><h3 id="1-1-11-1、四个核心组件"><a href="#1-1-11-1、四个核心组件" class="headerlink" title="1.1.11.1、四个核心组件"></a>1.1.11.1、四个核心组件</h3><p>1.服务端采集器(刮擦器，pull Exporter暴露出来的数据) 基于http协议实现; 从被采集端(target)得到样本数据；<br>2.Exporter采集数据端，提供各种服务的exporter数据采集支持；<br>3.AlertManager告警组件，通过内置的PromQL创建告警规则，并对接到告警介质发送告警；<br>4.PushGateway 在不支持pull的场景使用此组件可支持push推送数据；</p><h3 id="1-1-11-2、Server端三种途径来抓取数据"><a href="#1-1-11-2、Server端三种途径来抓取数据" class="headerlink" title="1.1.11.2、Server端三种途径来抓取数据"></a>1.1.11.2、Server端三种途径来抓取数据</h3><ol><li>exporters客户端抓取</li><li>Instrumentation 应用程序自建的监控，内部测量系统抓取</li><li>PushGateway 临时抓取场景</li></ol><p>抓取过啊里的数据，存储在自己的TSDB(Time Series Database)数据中，PromQL 将抓取的数据进行过滤</p><h3 id="1-1-11-3、数据模型-4种"><a href="#1-1-11-3、数据模型-4种" class="headerlink" title="1.1.11.3、数据模型(4种)"></a>1.1.11.3、数据模型(4种)</h3><p>指标类型(metric types),双精度数据类型进行存储</p><p>1.Counter 计数器<br>用于保存单调递增型的数据，如站点访问次数，不能为负数，也不支持减少但可以重置回0；</p><p>2.Gauge 仪表盘<br>上下浮动的数据，例如内存大小、温度、分位数统计；</p><p>3.Histogram 直方图<br>在一段时间范围内对数据进行采样，并将其计入可配置的backet中，分段统计平均值；</p><p>4.Summary 摘要，<br>客户端统计好拿过来的；</p><p>PromQL(Prometheus Query Language, Prometheus内置查询语言)<br>查询出来的结果有多种，时间向量值</p><h1 id="二、PromQL语句"><a href="#二、PromQL语句" class="headerlink" title="二、PromQL语句"></a>二、PromQL语句</h1><p>PromQL(Prometheus Query Language)是Prometheus Server内置数据查询语言<br>1.PromQL使用表达式(expression)来表述查询需求<br>2.根据其使用的指标和标签，以及时间范围，表达式的查询请求可灵活的覆盖在一个或多个时间序列的一定范围内的样本之上，甚至是包含单个时间序列的单个样本、</p><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="2-1、Prometheus时间序列-数据集"><a href="#2-1、Prometheus时间序列-数据集" class="headerlink" title="2.1、Prometheus时间序列(数据集):"></a>2.1、Prometheus时间序列(数据集):</h2><p>时间序列数据，按照时间顺序记录系统，设备状态变化的数据，每个数据称为一个样本;</p><ol><li><p>数据采集以特定的时间轴进行，因而，随着时间流逝，将这些样本数据纪律下来，将生成一个离散的样本数据序列;</p></li><li><p>该序列也称为向量(Vector),而将多个序列放在同一个坐标系内(以时间为横轴，以序列为纵轴),将形成一个有数据点组成的矩阵;</p></li></ol><p>Prometheus基于指标名称(metrics name)以及附属的标签集(labelset)唯一定义一条时间序列<br>1.指标名称代表着监控目标上某类可测量属性的基本特征表示<br>2.标签则是这个基本特征上再次细分的多个可测量维度</p><p>基于PromQL表达式，用户可以针对指定的特征及细分的维度进行过滤，聚合统计等运算从而产生期望的计算结果；</p><h2 id="2-2、Prometheus数据模型："><a href="#2-2、Prometheus数据模型：" class="headerlink" title="2.2、Prometheus数据模型："></a>2.2、Prometheus数据模型：</h2><p>Prometheus中，每个时间序列都由指标名称(metric Name)和标签(Label)来唯一标识<br>格式为”<metric name>{label name}&#x3D;<label value>,…”;</p><p>指标名称：通常用于描述系统上要测丢你个的某个特征(例如: httpreqyests_total 表示接收到的HTTP请求总数)；<br>标签： 键值型数据，附加在指标名称之上，从而让指标能能够支持多个维度特征; 可选项；</p><p>注意:  __ 开头的标签不要使用，一般用于系统默认格式</p><h2 id="2-3、指标名称及标签使用注意事项"><a href="#2-3、指标名称及标签使用注意事项" class="headerlink" title="2.3、指标名称及标签使用注意事项"></a>2.3、指标名称及标签使用注意事项</h2><p>指标名称和标签的特定组合代表着一个时间序列<br>    1. 指标名称相同，但标签不同的组合分别代表着不同的时序列<br>    2. 不同的指标名称自然更是代表着不同的时间序列</p><p><strong>PromQL支持基于定义的指标维度进行过滤和聚合</strong></p><ol><li>更改任标签值，包括添加和删除标签，都会创建一个新的时间序列</li><li>应该尽可能的保持标签的稳定性，否则，则可能创建新的时间序列，更甚者会声称要给动态的数据环境，并是的监控的数据源难以跟踪，从而导致建立在该指标之上的图形、告警记录到规则变得无效</li></ol><h2 id="2-4、PromQL数据类型"><a href="#2-4、PromQL数据类型" class="headerlink" title="2.4、PromQL数据类型"></a>2.4、PromQL数据类型</h2><h3 id="2-4-1、PromQL的表达式中支持4中数据类型"><a href="#2-4-1、PromQL的表达式中支持4中数据类型" class="headerlink" title="2.4.1、PromQL的表达式中支持4中数据类型"></a>2.4.1、PromQL的表达式中支持4中数据类型</h3><h4 id="2-4-1-2、即时向量-Instant-Vector"><a href="#2-4-1-2、即时向量-Instant-Vector" class="headerlink" title="2.4.1.2、即时向量(Instant Vector):"></a>2.4.1.2、即时向量(Instant Vector):</h4><p>特定或全部的时间序列集合上， 具有相同时间戳的一组样本值称为即时向量；</p><h4 id="2-4-1-3、范围向量-Range-Vector"><a href="#2-4-1-3、范围向量-Range-Vector" class="headerlink" title="2.4.1.3、范围向量(Range Vector):"></a>2.4.1.3、范围向量(Range Vector):</h4><p>特定或全部的时间系列集合上，值再定的同意时间范围内的所有样本值；</p><h4 id="2-4-1-4、标量-Scalar"><a href="#2-4-1-4、标量-Scalar" class="headerlink" title="2.4.1.4、标量(Scalar):"></a>2.4.1.4、标量(Scalar):</h4><p>一个浮点型的数据值；</p><h4 id="2-4-1-5、字符串-String-："><a href="#2-4-1-5、字符串-String-：" class="headerlink" title="2.4.1.5、字符串(String)："></a>2.4.1.5、字符串(String)：</h4><p>支持使用单引号、双引号或反引号，但是反引号中不会对转移字符进行转义</p><h2 id="2-5、PromQL指标类型"><a href="#2-5、PromQL指标类型" class="headerlink" title="2.5、PromQL指标类型"></a>2.5、PromQL指标类型</h2><pre><code class="hljs">四个指标类型，主要由prometheus的客户端库使用</code></pre><h3 id="2-5-1、Counter-计数器"><a href="#2-5-1、Counter-计数器" class="headerlink" title="2.5.1、Counter 计数器"></a>2.5.1、Counter 计数器</h3><p>单调递增，除非重置</p><h3 id="2-5-2、Gauge-仪表盘"><a href="#2-5-2、Gauge-仪表盘" class="headerlink" title="2.5.2、Gauge  仪表盘"></a>2.5.2、Gauge  仪表盘</h3><p>可增可减的数据</p><h3 id="2-5-3、Histogram-直方图"><a href="#2-5-3、Histogram-直方图" class="headerlink" title="2.5.3、Histogram 直方图"></a>2.5.3、Histogram 直方图</h3><p>将时间范围内的数据划分成不同的时间段，并各自评估其样本个数及样本值之和，因而可计算出分位数</p><h3 id="2-5-4、Summary"><a href="#2-5-4、Summary" class="headerlink" title="2.5.4、Summary"></a>2.5.4、Summary</h3><p>类似于Histogram，但客户端会直接计算并上报分位数</p><h2 id="2-6、PromQL运算符"><a href="#2-6、PromQL运算符" class="headerlink" title="2.6、PromQL运算符"></a>2.6、PromQL运算符</h2><pre><code class="hljs">指标标识: &lt;netric_name&gt;&#123;label=value,...&#125;过滤时间序列:metric_name: 只查询该指标名称下的所有时间序列</code></pre><h3 id="2-6-1、查询匹配器"><a href="#2-6-1、查询匹配器" class="headerlink" title="2.6.1、查询匹配器"></a>2.6.1、查询匹配器</h3><h4 id="2-6-1-1、比较符"><a href="#2-6-1-1、比较符" class="headerlink" title="2.6.1.1、比较符"></a>2.6.1.1、比较符</h4><p>{}: &#x3D;, !&#x3D;, &#x3D;<del>, !</del><br>&#x3D; 等于<br>!&#x3D; 不等于<br>&#x3D;~ 模式匹配<br>!~ 不匹配</p><h4 id="2-6-1-2、返回值的四种类型"><a href="#2-6-1-2、返回值的四种类型" class="headerlink" title="2.6.1.2、返回值的四种类型"></a>2.6.1.2、返回值的四种类型</h4><p>即时向量<br>范围向量<br>标量<br>字符串</p><h3 id="2-6-2、PromQL聚合函数"><a href="#2-6-2、PromQL聚合函数" class="headerlink" title="2.6.2、PromQL聚合函数"></a>2.6.2、PromQL聚合函数</h3><pre><code class="hljs">多个target上的同一个指标进行统计内置提供了11个聚合函数，仅支持用于单个即时向量的元素sum() 对样本值求和avg() 对样本值求平局值count() 对分组内的时间序列进行数量统计stddev() 对样本值求标准差，了解数据波动大小 stdvar() 对样本值求方差，他是求取标准差过程中的中间状态min()  求取样本值中的最小者max()  求取样本值中的最大者topk() 逆序返回分组内的样本值最大的前k个时间序列和它的值 取最大的值bottomk() 顺序返回组内的样本值最小的前K个时间序列和它的值  取最小的值quantile() 分位数用于评估数据的分布状态，该会返回分组内指定的分位数的值，即数值落在小于等于指定的分为区间的比例count_values() 对分株内的时间序列的样本值进行数量统计</code></pre><h3 id="2-6-3、普通函数"><a href="#2-6-3、普通函数" class="headerlink" title="2.6.3、普通函数"></a>2.6.3、普通函数</h3><pre><code class="hljs">    官网地址: [https://prometheus.io/docs/prometheus/latest/querying/functions/](https://prometheus.io/docs/prometheus/latest/querying/functions/)    abs()    absent()    absent_over_time()    ceil()    changes()    clamp()    clamp_max()    clamp_min()    day_of_month()    day_of_week()    days_in_month()    delta()    deriv()    exp()    floor()    histogram_quantile()    holt_winters()    hour()    idelta()    increase()    irate()    label_join()    label_replace()    ln()    log2()    log10()    minute()    month()    predict_linear()    rate()    resets()    round()    scalar()    sgn()    sort()    sort_desc()    sqrt()    time()    timestamp()    vector()    year()    &lt;aggregation&gt;_over_time()</code></pre><h3 id="2-6-4、二元运算符-Binary-Operators"><a href="#2-6-4、二元运算符-Binary-Operators" class="headerlink" title="2.6.4、二元运算符(Binary Operators)"></a>2.6.4、二元运算符(Binary Operators)</h3><p>PromQL支持基本的算术运算和逻辑运算，这剋运算支持使用操作符链接两个操作数，因而也称为二元运算符或二元操作符;</p><pre><code class="hljs">    算术运算:</code></pre><p>+(加)、 -(减)、 *(乘)、 &#x2F;(除)、 %(取模)、 ^(幂运算)；</p><pre><code class="hljs">    比较运算:</code></pre><p>&#x3D;&#x3D;(等值比较)、!&#x3D;(不等于)、&gt;(大于)、&lt;(小于)、&gt;&#x3D;(大于等于)、&gt;&#x3D;(小于等于) ；</p><pre><code class="hljs">    逻辑/集合运算:</code></pre><p>and(并且)、or(或者)、unless(除了) ；<br>{目前该运算仅允许在两个即时向量间进行，尚不支持标量参与运算}</p><h1 id="三、Grafana看板组件"><a href="#三、Grafana看板组件" class="headerlink" title="三、Grafana看板组件"></a>三、Grafana看板组件</h1><h2 id="3-1、基础概念"><a href="#3-1、基础概念" class="headerlink" title="3.1、基础概念"></a>3.1、基础概念</h2><p>持久化的场景，我们将通过promQL规则查询数据，而这个规则在Prometheus中查询后刷新就没了，表达式无法做到持久化使用，而要实现这种需求，就可以结合grafana进行实现</p><p>直接安装，并添加数据源即可展示监控图标; 监控图标可在官方站点下载别人分享的优秀示例。</p><h2 id="3-2、模板使用"><a href="#3-2、模板使用" class="headerlink" title="3.2、模板使用"></a>3.2、模板使用</h2><p>视图下载官方地址: <a href="https://grafana.com/grafana/dashboards">https://grafana.com/grafana/dashboards</a><br>根据数据源搜索即可下载，也可以复制模板ID号导入到面板中</p><h1 id="四、Alertmanager告警组件"><a href="#四、Alertmanager告警组件" class="headerlink" title="四、Alertmanager告警组件"></a>四、Alertmanager告警组件</h1><h2 id="4-1、基础概念"><a href="#4-1、基础概念" class="headerlink" title="4.1、基础概念"></a>4.1、基础概念</h2><p>除了基本的告警通知能力外alertmanager还支持对告警进行去重、分组、抑制、静默和路由等功能</p><p>**分组(grouping) **<br>将相似告警合并为单个告警通知的机制，在系统因大面积故障而处罚告警潮时，分组机制能避免用户被大量的告警噪声淹没，进而导致关键信息的隐没</p><p><strong>抑制(Inhibition)</strong><br>系统中某个组件或服务故障而触发告警通知后，那些依赖于该组件或服务的其他组件或服务可能会因此而处罚告警，抑制便是避免类似的级联告警的一种特性，从而让用户能将精力集中于真正的故障所在</p><p><strong>静默(Silent)</strong><br>是指在一个特定的时间窗口内，即便接收到告警通知，。Alertmanger也不会真正想用户发送告警信息的行为，通常，在系统例行维护期间，需要激活告警系统的静默特性；</p><p><strong>路由(route)</strong><br>用户配置Alertmanager如何处理传入的特定类型的告警通知，其基本逻辑是根据路与欧匹配规则的匹配结果来确定处理当前告警路径和行为</p><h2 id="4-2、高级规则模板"><a href="#4-2、高级规则模板" class="headerlink" title="4.2、高级规则模板"></a>4.2、高级规则模板</h2><p>高级规则文件如果在服务器需求比较多的情况下，对于高级规则的编写也是一个不小的工作量，但是在github中有着不错的优秀模板，我们可以开箱即用，模板地址: <a href="https://github.com/samber/awesome-prometheus-alerts">https://github.com/samber/awesome-prometheus-alerts</a></p><p>规则模板官方地址: <a href="https://awesome-prometheus-alerts.grep.to/">https://awesome-prometheus-alerts.grep.to</a> , 直接下载对接使用即可。</p>]]></content>
    
    
    <categories>
      
      <category>prometheus</category>
      
    </categories>
    
    
    <tags>
      
      <tag>原创</tag>
      
      <tag>prometheus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>02-prometheus-server部署</title>
    <link href="/2024/07/25/02-prometheus-server%E9%83%A8%E7%BD%B2-1/"/>
    <url>/2024/07/25/02-prometheus-server%E9%83%A8%E7%BD%B2-1/</url>
    
    <content type="html"><![CDATA[<h1 id="基础准备"><a href="#基础准备" class="headerlink" title="基础准备"></a>基础准备</h1><p>基于云主机进行部署，其他主机环境问题请自行解决或初始化之后进行操作</p><h2 id="服务器规划"><a href="#服务器规划" class="headerlink" title="服务器规划"></a>服务器规划</h2><table><thead><tr><th><strong>IP地址</strong></th><th><strong>操作系统</strong></th><th><strong>组件安排</strong></th></tr></thead><tbody><tr><td>172.17.88.230</td><td>Centos7.9</td><td>Prometheus-server&#x2F;Alertmanager</td></tr><tr><td>172.17.88.231</td><td>Centos7.9</td><td>node</td></tr><tr><td>172.17.88.232</td><td>Centos7.9</td><td>Grafana</td></tr></tbody></table><h2 id="服务器初始化"><a href="#服务器初始化" class="headerlink" title="服务器初始化"></a>服务器初始化</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ systemctl stop firewalld.service<br>$ systemctl <span class="hljs-built_in">disable</span> firewalld.service<br>$ setenforce 0<br>$ sed -i <span class="hljs-string">&#x27;s/enforcing/disabled/g&#x27;</span> /etc/selinux/config<br></code></pre></td></tr></table></figure><p>官方文档： <a href="https://prometheus.io/docs/introduction/overview/">https://prometheus.io/docs/introduction/overview/</a><br>安装包下载: <a href="https://prometheus.io/download/">https://prometheus.io/download/</a><br>全部组件使用最新版本</p><h1 id="一、Prometheus-server部署"><a href="#一、Prometheus-server部署" class="headerlink" title="一、Prometheus-server部署"></a>一、Prometheus-server部署</h1><h2 id="1-1、下载包并解压Prometheus-server安装包"><a href="#1-1、下载包并解压Prometheus-server安装包" class="headerlink" title="1.1、下载包并解压Prometheus-server安装包"></a>1.1、下载包并解压Prometheus-server安装包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@prometheus-server ~]# wget https://github.com/prometheus/prometheus/releases/download/v2.28.1/prometheus-2.28.1.linux-amd64.tar.gz<br>[root@prometheus-server ~]# tar -xf prometheus-2.28.1.linux-amd64.tar.gz -C /usr/local/<br>[root@prometheus-server ~]# <span class="hljs-built_in">cd</span> !$ &amp;&amp; <span class="hljs-built_in">ln</span> -sv prometheus-2.28.1.linux-amd64 prometheus<br><span class="hljs-built_in">cd</span> /usr/local/ &amp;&amp; <span class="hljs-built_in">ln</span> -sv prometheus-2.28.1.linux-amd64 prometheus<br></code></pre></td></tr></table></figure><h2 id="1-2、主配置文件配置并启动-单机部署"><a href="#1-2、主配置文件配置并启动-单机部署" class="headerlink" title="1.2、主配置文件配置并启动(单机部署)"></a>1.2、主配置文件配置并启动(单机部署)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@prometheus-server prometheus]# <span class="hljs-built_in">cd</span> /usr/local/prometheus/ &amp;&amp; <span class="hljs-built_in">cp</span> -p prometheus.yml prometheus.ymlbak<br>[root@prometheus-server prometheus]# vim prometheus.yml<br>global: <span class="hljs-comment"># 全局配置</span><br>  scrape_interval:     10s <span class="hljs-comment"># 抓取时间</span><br>  evaluation_interval: 10s <span class="hljs-comment"># 规则引擎轮询时间</span><br>  query_log_file: <span class="hljs-string">&#x27;query.log&#x27;</span> <span class="hljs-comment"># promQL查询日志</span><br><br><span class="hljs-comment"># 告警对接配置</span><br>alerting:<br>  alertmanagers:<br>  - file_sd_configs:<br>    - files:<br>      - /usr/local/prometheus/targets/alertmanager-server.yaml<br><br><span class="hljs-comment"># 规则引擎具体规则配置</span><br>rule_files:<br>  - /usr/local/prometheus/rules/*.yaml<br>  <span class="hljs-comment"># 添加告警规则</span><br>  - /usr/local/prometheus/alerting_rules/*.yaml<br><br>scrape_configs: <span class="hljs-comment"># 抓取配置</span><br>  - job_name: <span class="hljs-string">&#x27;prometheus&#x27;</span><br>    basic_auth:<br>      username: admin<br>      password: 123123<br>    file_sd_configs:<br>    - files:<br>      - /usr/local/prometheus/targets/prometheus*.yaml<br>      refresh_interval: 1m<br><br>  - job_name: <span class="hljs-string">&#x27;alertmanager-server&#x27;</span><br>    file_sd_configs:<br>    - files:<br>      - /usr/local/prometheus/targets/alertmanager*.yaml<br>      refresh_interval: 1m<br><br>  - job_name: <span class="hljs-string">&#x27;granafa-server&#x27;</span><br>    file_sd_configs:<br>    - files:<br>      - /usr/local/prometheus/targets/grafana*.yaml<br>      refresh_interval: 1m<br><br>  - job_name: <span class="hljs-string">&#x27;nodes&#x27;</span><br>    file_sd_configs:<br>    - files:<br>      - /usr/local/prometheus/targets/nodes*.yaml<br>      refresh_interval: 1m<br><br><br><br><span class="hljs-comment"># 创建目录备用</span><br>[root@prometheus-server prometheus]# <span class="hljs-built_in">mkdir</span> /usr/local/prometheus/rules<br>[root@prometheus-server prometheus]# <span class="hljs-built_in">mkdir</span> /usr/local/prometheus/targets<br>[root@prometheus-server prometheus]# <span class="hljs-built_in">mkdir</span> /usr/local/prometheus/alerting_rules<br><br><br><br><span class="hljs-comment"># systemd管理文件配置</span><br>[root@os7server prometheus]# vim /usr/lib/systemd/system/prometheus.service<br>[Unit]<br>Description=Prometheus Node Exporter<br>After=network.target<br><br>[Service]<br>ExecStart=/usr/local/prometheus/prometheus --web.config.file=/usr/local/prometheus/webConfig.yaml \<br>    --config.file=/usr/local/prometheus/prometheus.yml \<br>    --web.read-timeout=5m \<br>    --web.max-connections=10 \<br>    --storage.tsdb.retention=7d \<br>    --storage.tsdb.path=/usr/local/prometheus/data \<br>    --query.max-concurrency=2000 \<br>    --query.timeout=2m<br>[Install]<br>WantedBy=multi-user.target<br><br><br><span class="hljs-comment"># 开机启动</span><br>[root@prometheus-server prometheus]# systemctl <span class="hljs-built_in">enable</span> prometheus.service<br>Created symlink from /etc/systemd/system/multi-user.target.wants/prometheus.service to /usr/lib/systemd/system/prometheus.service.<br><br><br><br><span class="hljs-comment"># 基础页面访问认证添加</span><br><span class="hljs-comment"># 生成basic_auth配置</span><br><span class="hljs-comment"># 参数 --web.config.file=/usr/local/prometheus/webConfig.yaml</span><br><span class="hljs-comment"># web.basicAuth 认证配置 --web.config.file=&quot;&quot; </span><br><span class="hljs-comment"># https配置，basicAuth配置</span><br><span class="hljs-comment"># 官网地址: https://prometheus.io/docs/prometheus/latest/configuration/https/</span><br><br><span class="hljs-comment"># 密码使用apache的工具生成</span><br>[root@prometheus-server prometheus]# yum install -y httpd-tools<br>[root@prometheus-server prometheus]# htpasswd -Bn admin<br>New password:<br>Re-<span class="hljs-built_in">type</span> new password:<br>admin:$2y$05<span class="hljs-variable">$EdMgHh2IF1izSh6lt1Fp7e98jtvtAtd4</span>/cCm.wEYTpzY5h/v7fDlq<br>明文: alinx@123<br><br><br><span class="hljs-comment"># 基于base64编码，密码传输时获取后即可破解</span><br>[root@prometheus-server prometheus]# vim /usr/local/prometheus/webConfig.yaml<br>basic_auth_users:<br>  admin: <span class="hljs-string">&quot;$2y$05<span class="hljs-variable">$EdMgHh2IF1izSh6lt1Fp7e98jtvtAtd4</span>/cCm.wEYTpzY5h/v7fDlq&quot;</span><br>  alinx: <span class="hljs-string">&quot;$2y$05<span class="hljs-variable">$EdMgHh2IF1izSh6lt1Fp7e98jtvtAtd4</span>/cCm.wEYTpzY5h/v7fDlq&quot;</span><br>  <br><span class="hljs-comment"># 主配置文件中增加了 basic_auth 字段就是基于此进行的</span><br>global: <span class="hljs-comment"># 全局配置</span><br>  scrape_interval:     10s <span class="hljs-comment"># 抓取时间</span><br>  evaluation_interval: 10s <span class="hljs-comment"># 规则引擎轮询时间</span><br>  query_log_file: <span class="hljs-string">&#x27;query.log&#x27;</span> <span class="hljs-comment"># promQL查询日志</span><br><br><span class="hljs-comment"># 告警对接配置</span><br>alerting:<br>  alertmanagers:<br>  - file_sd_configs:<br>    - files:<br>      - /usr/local/prometheus/targets/alertmanager-server.yaml<br><br><span class="hljs-comment"># 规则引擎具体规则配置</span><br>rule_files:<br>  - /usr/local/prometheus/rules/*.yaml<br>  <span class="hljs-comment"># 添加告警规则</span><br>  - /usr/local/prometheus/alerting_rules/*.yaml<br><br>scrape_configs: <span class="hljs-comment"># 抓取配置</span><br>  - job_name: <span class="hljs-string">&#x27;prometheus&#x27;</span><br>    basic_auth:<br>      username: admin<br>      password: alinx@123<br>    file_sd_configs:<br>    - files:<br>      - /usr/local/prometheus/targets/prometheus*.yaml<br>      refresh_interval: 30s<br><br>  - job_name: <span class="hljs-string">&#x27;alertmanager-server&#x27;</span><br>    file_sd_configs:<br>    - files:<br>      - /usr/local/prometheus/targets/alertmanager*.yaml<br>      refresh_interval: 30s<br><br>  - job_name: <span class="hljs-string">&#x27;granafa-server&#x27;</span><br>    file_sd_configs:<br>    - files:<br>      - /usr/local/prometheus/targets/grafana*.yaml<br>      refresh_interval: 30s<br><br>  - job_name: <span class="hljs-string">&#x27;nodes&#x27;</span><br>    file_sd_configs:<br>    - files:<br>      - /usr/local/prometheus/targets/nodes*.yaml<br>      refresh_interval: 30s<br><br><br><br><br><span class="hljs-comment"># 启动Prometheus-server服务  </span><br><br>[root@prometheus-server prometheus]# systemctl start prometheus.service<br>[root@prometheus-server prometheus]# systemctl status prometheus.service<br>● prometheus.service - Prometheus Node Exporter<br>   Loaded: loaded (/usr/lib/systemd/system/prometheus.service; enabled; vendor preset: disabled)<br>   Active: active (running) since Fri 2021-07-30 16:35:06 CST; 5s ago<br> Main PID: 20439 (prometheus)<br>   CGroup: /system.slice/prometheus.service<br>           └─20439 /usr/local/prometheus/prometheus --web.config.file=/usr/local/prometheus/webConfig.yaml --config.file=/usr/local/prometheus/prometheus.yml --web.read-timeout=5m --web.max-connectio...<br><br>Jul 30 16:35:06 prometheus-server prometheus[20439]: level=info ts=2021-07-30T08:35:06.197Z <span class="hljs-built_in">caller</span>=head.go:780 component=tsdb msg=<span class="hljs-string">&quot;Replaying on-disk memory mappable chunks if any&quot;</span><br>Jul 30 16:35:06 prometheus-server prometheus[20439]: level=info ts=2021-07-30T08:35:06.197Z <span class="hljs-built_in">caller</span>=head.go:794 component=tsdb msg=<span class="hljs-string">&quot;On-disk memory mappable chunks replay completed&quot;</span> duration=5.397µs<br>Jul 30 16:35:06 prometheus-server prometheus[20439]: level=info ts=2021-07-30T08:35:06.197Z <span class="hljs-built_in">caller</span>=head.go:800 component=tsdb msg=<span class="hljs-string">&quot;Replaying WAL, this may take a while&quot;</span><br>Jul 30 16:35:06 prometheus-server prometheus[20439]: level=info ts=2021-07-30T08:35:06.198Z <span class="hljs-built_in">caller</span>=head.go:854 component=tsdb msg=<span class="hljs-string">&quot;WAL segment loaded&quot;</span> segment=0 maxSegment=0<br>Jul 30 16:35:06 prometheus-server prometheus[20439]: level=info ts=2021-07-30T08:35:06.198Z <span class="hljs-built_in">caller</span>=head.go:860 component=tsdb msg=<span class="hljs-string">&quot;WAL replay completed&quot;</span> checkpoint_replay_duration=16.997µ…tion=204.784µs<br>Jul 30 16:35:06 prometheus-server prometheus[20439]: level=info ts=2021-07-30T08:35:06.198Z <span class="hljs-built_in">caller</span>=main.go:851 fs_type=EXT4_SUPER_MAGIC<br>Jul 30 16:35:06 prometheus-server prometheus[20439]: level=info ts=2021-07-30T08:35:06.198Z <span class="hljs-built_in">caller</span>=main.go:854 msg=<span class="hljs-string">&quot;TSDB started&quot;</span><br>Jul 30 16:35:06 prometheus-server prometheus[20439]: level=info ts=2021-07-30T08:35:06.198Z <span class="hljs-built_in">caller</span>=main.go:981 msg=<span class="hljs-string">&quot;Loading configuration file&quot;</span> filename=/usr/local/prometheus/prometheus.yml<br>Jul 30 16:35:06 prometheus-server prometheus[20439]: level=info ts=2021-07-30T08:35:06.200Z <span class="hljs-built_in">caller</span>=main.go:1012 msg=<span class="hljs-string">&quot;Completed loading of configuration file&quot;</span> filename=/usr/local/prometheus/prometheus…µs<br>Jul 30 16:35:06 prometheus-server prometheus[20439]: level=info ts=2021-07-30T08:35:06.200Z <span class="hljs-built_in">caller</span>=main.go:796 msg=<span class="hljs-string">&quot;Server is ready to receive web requests.&quot;</span><br>Hint: Some lines were ellipsized, use -l to show <span class="hljs-keyword">in</span> full.<br><br><br></code></pre></td></tr></table></figure><h2 id="1-3、访问测试"><a href="#1-3、访问测试" class="headerlink" title="1.3、访问测试"></a>1.3、访问测试</h2><p><a href="http://172.17.88.230:9090/metric">http://172.17.88.230:9090/metric</a></p><p><img src="https://cdn.nlark.com/yuque/0/2021/png/278129/1627718150790-212cf521-9ae1-457e-b408-30ed68221eda.png#clientId=u5823aafd-c106-4&from=paste&height=600&id=uc211d0e5&originHeight=600&originWidth=1186&originalType=binary&ratio=1&rotation=0&showTitle=false&size=45872&status=done&style=none&taskId=u1a6ba3e9-acb7-4c8e-a899-318cf4cc303&title=&width=1186" alt="image.png"></p><p>可能会出现时间同步问题，那就把时间同步做一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ yum install -y ntp<br>$ vim /etc/ntp.conf<br>driftfile /var/lib/ntp/drift<br>restrict default nomodify notrap nopeer noquery<br>restrict 127.0.0.1<br>restrict ::1<br><span class="hljs-comment"># 手动添加配置</span><br>server ntp1.aliyun.com prefer<br>server ntp2.aliyun.com<br><span class="hljs-comment"># 原有配置</span><br>server 0.centos.pool.ntp.org iburst<br>server 1.centos.pool.ntp.org iburst<br>server 2.centos.pool.ntp.org iburst<br>server 3.centos.pool.ntp.org iburst<br>includefile /etc/ntp/crypto/pw<br>keys /etc/ntp/keys<br><span class="hljs-built_in">disable</span> monitor<br></code></pre></td></tr></table></figure><h2 id="1-4、Prometheus-server自身监控自动发现配置文件编写"><a href="#1-4、Prometheus-server自身监控自动发现配置文件编写" class="headerlink" title="1.4、Prometheus-server自身监控自动发现配置文件编写"></a>1.4、Prometheus-server自身监控自动发现配置文件编写</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@prometheus-server prometheus]# vim /usr/local/prometheus/targets/prometheus-servers.yaml<br>- targets:<br>  - 172.17.88.230:9090<br>  labels:<br>    app: prometheus-server<br></code></pre></td></tr></table></figure><h2 id=""><a href="#" class="headerlink" title=""></a></h2><p>主配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs bash">global: <span class="hljs-comment"># 全局配置</span><br>  scrape_interval:     10s <span class="hljs-comment"># 抓取时间</span><br>  evaluation_interval: 10s <span class="hljs-comment"># 规则引擎轮询时间</span><br>  query_log_file: <span class="hljs-string">&#x27;query.log&#x27;</span> <span class="hljs-comment"># promQL查询日志</span><br><br><span class="hljs-comment"># 告警对接配置 通过基于文件的服务发现</span><br>alerting:<br>  alertmanagers:<br>  - file_sd_configs:<br>    - files:<br>      - /usr/local/prometheus/targets/alertmanager-server.yaml<br><br><span class="hljs-comment"># 规则引擎具体规则配置</span><br>rule_files:<br><span class="hljs-comment"># 添加告警规则 告警规则定义目录，根据此进行告警通知</span><br>  - /usr/local/prometheus/rules/*.yaml<br>  - /usr/local/prometheus/alerting_rules/*.yaml<br><br>scrape_configs: <span class="hljs-comment"># 抓取配置</span><br>  - job_name: <span class="hljs-string">&#x27;prometheus&#x27;</span><br>    basic_auth: <span class="hljs-comment"># 认证配置</span><br>      username: admin<br>      password: alinx@123<br>    file_sd_configs: <span class="hljs-comment"># 基于文件的自动发现</span><br>    - files:<br>      - /usr/local/prometheus/targets/prometheus*.yaml<br>      refresh_interval: 30s<br><span class="hljs-comment"># 告警组件自动发现</span><br>  - job_name: <span class="hljs-string">&#x27;alertmanager-server&#x27;</span><br>    file_sd_configs: <span class="hljs-comment"># 基于文件的自动发现</span><br>    - files:<br>      - /usr/local/prometheus/targets/alertmanager*.yaml<br>      refresh_interval: 30s<br><span class="hljs-comment"># grafana-server监控</span><br>  - job_name: <span class="hljs-string">&#x27;grafana-server&#x27;</span><br>    file_sd_configs: <span class="hljs-comment"># 基于文件的自动发现</span><br>    - files:<br>      - /usr/local/prometheus/targets/grafana*.yaml<br>      refresh_interval: 30s<br><br><span class="hljs-comment"># 监控节点</span><br>  - job_name: <span class="hljs-string">&#x27;nodes&#x27;</span><br>    file_sd_configs: <span class="hljs-comment"># 基于文件的自动发现</span><br>    - files:<br>      - /usr/local/prometheus/targets/nodes*.yaml<br>      refresh_interval: 30s<br></code></pre></td></tr></table></figure><p>再次访问测试<br><a href="http://172.17.88.230:9090/">http://172.17.88.230:9090</a><br><img src="https://cdn.nlark.com/yuque/0/2021/png/278129/1627718834920-fa0215ea-f1f3-48d4-84c1-5e7b70397e90.png#clientId=u5823aafd-c106-4&from=paste&height=761&id=ud65d36b1&originHeight=761&originWidth=1915&originalType=binary&ratio=1&rotation=0&showTitle=false&size=57204&status=done&style=none&taskId=u1342dbe8-a069-4756-814c-ab97d9899a1&title=&width=1915" alt="image.png"></p><p><img src="https://cdn.nlark.com/yuque/0/2021/png/278129/1627718853483-cc62c920-043a-4908-93b0-774c5f6adc4e.png#clientId=u5823aafd-c106-4&from=paste&height=797&id=ua1f5beb0&originHeight=797&originWidth=1700&originalType=binary&ratio=1&rotation=0&showTitle=false&size=70346&status=done&style=none&taskId=u33d4a521-ce01-4dde-85b4-f62101cd059&title=&width=1700" alt="image.png"></p>]]></content>
    
    
    <categories>
      
      <category>prometheus</category>
      
    </categories>
    
    
    <tags>
      
      <tag>原创</tag>
      
      <tag>prometheus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>04-grafana部署对接</title>
    <link href="/2024/07/25/04-grafana%E9%83%A8%E7%BD%B2%E5%AF%B9%E6%8E%A5/"/>
    <url>/2024/07/25/04-grafana%E9%83%A8%E7%BD%B2%E5%AF%B9%E6%8E%A5/</url>
    
    <content type="html"><![CDATA[<p><strong>安装Grafana监控面板安装方式众多，源码安装，二进制安装，rpm包安装，docker安装</strong></p><h1 id="Docker方式安装Grafana"><a href="#Docker方式安装Grafana" class="headerlink" title="Docker方式安装Grafana"></a>Docker方式安装Grafana</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 安装docker</span><br>[root@monitor-views ~]# <span class="hljs-built_in">sudo</span> yum remove docker \<br>&gt;                   docker-client \<br>&gt;                   docker-client-latest \<br>&gt;                   docker-common \<br>&gt;                   docker-latest \<br>&gt;                   docker-latest-logrotate \<br>&gt;                   docker-logrotate \<br>&gt;                   docker-engine<br>Loaded plugins: fastestmirror<br>No Match <span class="hljs-keyword">for</span> argument: docker<br>No Match <span class="hljs-keyword">for</span> argument: docker-client<br>No Match <span class="hljs-keyword">for</span> argument: docker-client-latest<br>No Match <span class="hljs-keyword">for</span> argument: docker-common<br>No Match <span class="hljs-keyword">for</span> argument: docker-latest<br>No Match <span class="hljs-keyword">for</span> argument: docker-latest-logrotate<br>No Match <span class="hljs-keyword">for</span> argument: docker-logrotate<br>No Match <span class="hljs-keyword">for</span> argument: docker-engine<br>No Packages marked <span class="hljs-keyword">for</span> removal<br><br><br><br>[root@monitor-views ~]# <span class="hljs-built_in">sudo</span> yum install -y yum-utils \<br>&gt;   device-mapper-persistent-data \<br>&gt;   lvm2<br>Loaded plugins: fastestmirror<br>Determining fastest mirrors<br>base     | 3.6 kB  00:00:00<br>epel    | 4.7 kB  00:00:00<br>extras| 2.9 kB  00:00:00<br>updates | 2.9 kB  00:00:00<br>(1/7): epel/x86_64/group_gz         |  96 kB  00:00:00<br>(2/7): base/7/x86_64/group_gz       <br>......<br>device-mapper-event.x86_64 7:1.02.170-6.el7_9.5       device-mapper-event-libs.x86_64 7:1.02.170-6.el7_9.5       libaio.x86_64 0:0.3.109-13.el7            libxml2-python.x86_64 0:2.9.1-6.el7.5<br>lvm2-libs.x86_64 7:2.02.187-6.el7_9.5                 python-chardet.noarch 0:2.2.1-3.el7                        python-kitchen.noarch 0:1.1.1-5.el7<br><br>Complete!<br><br><br><span class="hljs-comment"># 阿里云镜像源地址</span><br>[root@monitor-views ~]# <span class="hljs-built_in">sudo</span> yum-config-manager \<br>&gt;     --add-repo \<br>&gt;     http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br>Loaded plugins: fastestmirror<br>adding repo from: http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br>grabbing file http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo to /etc/yum.repos.d/docker-ce.repo<br>repo saved to /etc/yum.repos.d/docker-ce.repo<br><br><span class="hljs-comment"># 清华大学源</span><br>$ <span class="hljs-built_in">sudo</span> yum-config-manager \<br>--add-repo \<br>https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/docker-ce.repo<br><br><span class="hljs-comment"># 安装</span><br>[root@monitor-views ~]# <span class="hljs-built_in">sudo</span> yum install docker-ce docker-ce-cli containerd.io -y<br>[root@monitor-views ~]# <span class="hljs-built_in">mkdir</span> /etc/docker<br>[root@monitor-views ~]# vim /etc/docker/daemon.json<br>&#123;<br><span class="hljs-string">&quot;registry-mirrors&quot;</span>:[<span class="hljs-string">&quot;https://reg-mirror.qiniu.com/&quot;</span>]<br>&#125;<br><br><span class="hljs-comment"># 启动</span><br>[root@monitor-views ~]# systemctl <span class="hljs-built_in">enable</span> docker<br>Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.<br>[root@monitor-views ~]# systemctl start docker<br>[root@monitor-views ~]# systemctl status docker<br>● docker.service - Docker Application Container Engine<br>Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; vendor preset: disabled)<br>Active: active (running) since Fri 2021-07-30 16:55:35 CST; 20ms ago<br>Docs: https://docs.docker.com<br>Main PID: 7521 (dockerd)<br>Tasks: 13<br>Memory: 47.4M<br>CGroup: /system.slice/docker.service<br>└─7521 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock<br>......<br><br>[root@monitor-views ~]# docker run -d -p 3000:3000 --name grafana-server grafana/grafana<br>240e0d608f0a450f48982a728aec9876baa3cf1fe453950a57e3f1b9cdb2ba17<br><br>[root@monitor-views ~]# docker ps<br>CONTAINER ID   IMAGE             COMMAND     CREATED          STATUS          PORTS                                       NAMES<br>240e0d608f0a   grafana/grafana   <span class="hljs-string">&quot;/run.sh&quot;</span>   18 seconds ago   Up 17 seconds   0.0.0.0:3000-&gt;3000/tcp, :::3000-&gt;3000/tcp   grafana-server<br><br><br><br></code></pre></td></tr></table></figure><p>访问测试<a href="http://172.17.88.232:3000/login">http://172.17.88.232:3000/login</a><br>默认密码: admin&#x2F;admin,首次登录后修改密码<br>admin&#x2F;Narwal@123</p><h2 id="模板使用"><a href="#模板使用" class="headerlink" title="模板使用"></a>模板使用</h2><p>视图下载官方地址: <a href="https://grafana.com/grafana/dashboards">https://grafana.com/grafana/dashboards</a><br>根据数据源搜索即可下载，也可以复制模板ID号导入到面板中</p>]]></content>
    
    
    <categories>
      
      <category>prometheus</category>
      
    </categories>
    
    
    <tags>
      
      <tag>原创</tag>
      
      <tag>prometheus</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
